(function(){var PopupXDM=(function(){return{}});PopupXDM.Client=(function(_url){var url,popupWindow,cfg=PopupXDM.Config,pollTimerId,adapter,frameHelper,channelIframe,eventListeners={authWindowResult:[]};if(typeof _url!=="undefined"){url=_url}adapter=new PopupXDM.Messenger();adapter.initClient();function triggerResultEvent(){var result=adapter.getResult(),event={};if(result){event.data=result}else{event.data=null}for(var i=0;i<eventListeners.authWindowResult.length;i++){if(typeof eventListeners.authWindowResult[i]=="function"){eventListeners.authWindowResult[i](event)}}}function isPopupOpened(){if(!popupWindow){return false}if(adapter.isPopupClosed()){return false}try{if(!popupWindow.closed){return true}else{return false}}catch(e){return false}}function pollPopupWindow(){if(isPopupOpened()){pollTimerId=setTimeout(function(){pollPopupWindow()},250);return}else{if(!pollTimerId){return}triggerResultEvent()}}return{addEventListener:function(type,callback){eventListeners[type].push(callback)},initFrameHelper:function(){if(!channelIframe){frameHelper=new PopupXDM.FrameHelper();channelIframe=frameHelper.createFrame()}},start:function(){this.initFrameHelper();adapter.resetClient();var params={},props=cfg.popupWindowProperties;if(window.outerWidth){props.left=(Math.round((window.outerWidth-props.width)/2)+window.screenX);props.top=(Math.round((window.outerHeight-props.height)/2)+window.screenY)}else{if(window.screen.width){props.left=(Math.round((window.screen.width-props.width)/2));props.top=(Math.round((window.screen.height-props.height)/2))}}var mergedProps=[];for(var p in props){mergedProps.push(p+"="+props[p])}popupWindow=window.open(PopupXDM.Util.buildUrl(url,params),"_pxdm_wnd_",mergedProps.join(","));pollPopupWindow()},getPopupWindowHandle:function(){return popupWindow},getChannelFrameHandle:function(){return channelIframe},setUrl:function(_url){url=_url},isFrameHelperLoaded:function(){return adapter&&adapter.isFrameHelperLoaded()}}});PopupXDM.Config=(function(){var scripts=document.getElementsByTagName("script"),lastScript=scripts[scripts.length-1].src,iframeChannelURL=lastScript.replace(lastScript.substring(lastScript.lastIndexOf("/")+1),"iframe-channel.html");return{resultCookieName:"clr",popupClosedCookie:"clrpc",iframeChannelURL:iframeChannelURL,popupWindowProperties:{menubar:"no",toolbar:"no",resizable:"yes",scrollbars:"yes",width:"600",height:"700"}}})();PopupXDM.FrameHelper=(function(){var cfg=PopupXDM.Config;return{createFrame:function(){var params={};params.refurl=location.protocol+"//"+location.host+location.pathname+(location.search?location.search:"");var channelIframe=document.createElement("iframe");channelIframe.src=PopupXDM.Util.buildUrl(cfg.iframeChannelURL,params);channelIframe.style.width="0";channelIframe.style.height="0";channelIframe.style.display="none";channelIframe.style.visibility="hidden";if(location.hash.match(/x\-postmessage\-id/)){location.hash=""}document.body.appendChild(channelIframe);return channelIframe},pollCookie:function(){if(PopupXDM.Util.getQueryParam("refurl")){var refurl=PopupXDM.Util.getQueryParam("refurl")}else{var refurl=null}var adapter=new PopupXDM.Messenger();adapter.initSender();adapter.setClientHandle(window.parent);adapter.setClientUrl(refurl);setInterval(function(){var rawData=PopupXDM.Util.getCookie(cfg.resultCookieName);if(rawData&&rawData.length){try{var data=PopupXDM.Util.JSON.parse(rawData)}catch(e){var data=null}if(data&&data.result){adapter.sendResult(data.result);PopupXDM.Util.removeCookie(cfg.resultCookieName)}}var popupClosedData=PopupXDM.Util.getCookie(cfg.popupClosedCookie);if(popupClosedData&&popupClosedData==1){adapter.handlePopupClose();PopupXDM.Util.removeCookie(cfg.popupClosedCookie)}},50);adapter.handleFrameHelperLoaded()}}});PopupXDM.Messenger=(function(){var clientHandle,senderHandle,result,popupClosed=false,frameHelperLoaded=false,clientUrl;function formatMessage(result){return PopupXDM.Util.JSON.stringify({result:result})}return{sendResult:function(_result){var payload=formatMessage(_result);try{PopupXDM.Util.pm({target:clientHandle,type:"result_data",data:payload,url:clientUrl})}catch(e){}},getResult:function(){return result},isPopupClosed:function(){return popupClosed},handlePopupClose:function(){try{PopupXDM.Util.pm({target:clientHandle,type:"popup_close",url:clientUrl,data:{closed:1}})}catch(e){}},handleFrameHelperLoaded:function(){try{PopupXDM.Util.pm({target:clientHandle,type:"frame_helper_loaded",url:clientUrl})}catch(e){}},initSender:function(){senderHandle=window;clientHandle=window.opener},setClientHandle:function(_clientHandle){clientHandle=_clientHandle},setClientUrl:function(_clientUrl){clientUrl=_clientUrl},initClient:function(){clientHandle=window;PopupXDM.Util.pm.bind("result_data",function(serializedData){var data=PopupXDM.Util.JSON.parse(serializedData);if(typeof data.result==="undefined"||!data.result){return}result=data.result});PopupXDM.Util.pm.bind("popup_close",function(data){if(data&&typeof data.closed!=="undefined"&&data.closed){popupClosed=true}});PopupXDM.Util.pm.bind("frame_helper_loaded",function(data){frameHelperLoaded=true})},resetClient:function(){result=null;popupClosed=false},isFrameHelperLoaded:function(){return frameHelperLoaded}}});PopupXDM.Sender=(function(){var cfg=PopupXDM.Config,result=null,adapter=new PopupXDM.Messenger();adapter.initSender();return{setResult:function(_result){result=_result;var payload=PopupXDM.Util.JSON.stringify({result:result});PopupXDM.Util.setCookie(cfg.resultCookieName,payload);adapter.sendResult(result)},close:function(){PopupXDM.Util.setCookie(cfg.popupClosedCookie,1);adapter.handlePopupClose();setTimeout(function(){window.close()},51)},finishWithoutClose:function(){PopupXDM.Util.setCookie(cfg.popupClosedCookie,1);adapter.handlePopupClose()}}});PopupXDM.Util=(function(){if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());var pmWrapper={fn:{},extend:function(){var a=arguments[0];for(var i=1,len=arguments.length;i<len;i++){var b=arguments[i];for(var prop in b){a[prop]=b[prop]}}return a}};(function(window,$,undefined){if(!("console" in window)){var c=window.console={};c.log=c.warn=c.error=c.debug=function(){}}$.fn.pm=function(){console.log("usage: \nto send:    $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])");return this};$.pm=function(options){pm.send(options)};$.pm.bind=function(type,fn,origin,hash,async_reply){pm.bind(type,fn,origin,hash,async_reply===true)};$.pm.unbind=function(type,fn){pm.unbind(type,fn)};$.pm.origin=null;$.pm.poll=200;var pm={send:function(options){var o=$.extend({},pm.defaults,options),target=o.target;if(!o.target){console.warn("postmessage target window required");return}if(!o.type){console.warn("postmessage type required");return}var msg={data:o.data,type:o.type};if(o.success){msg.callback=pm._callback(o.success)}if(o.error){msg.errback=pm._callback(o.error)}if(("postMessage" in target)&&!o.hash){pm._bind();target.postMessage(JSON.stringify(msg),o.origin||"*")}else{pm.hash._bind();pm.hash.send(o,msg)}},bind:function(type,fn,origin,hash,async_reply){pm._replyBind(type,fn,origin,hash,async_reply)},_replyBind:function(type,fn,origin,hash,isCallback){if(("postMessage" in window)&&!hash){pm._bind()}else{pm.hash._bind()}var l=pm.data("listeners.postmessage");if(!l){l={};pm.data("listeners.postmessage",l)}var fns=l[type];if(!fns){fns=[];l[type]=fns}fns.push({fn:fn,callback:isCallback,origin:origin||$.pm.origin})},unbind:function(type,fn){var l=pm.data("listeners.postmessage");if(l){if(type){if(fn){var fns=l[type];if(fns){var m=[];for(var i=0,len=fns.length;i<len;i++){var o=fns[i];if(o.fn!==fn){m.push(o)}}l[type]=m}}else{delete l[type]}}else{for(var i in l){delete l[i]}}}},data:function(k,v){if(v===undefined){return pm._data[k]}pm._data[k]=v;return v},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){var r=[];for(var i=0;i<32;i++){r[i]=pm._CHARS[0|Math.random()*32]}return r.join("")},_callback:function(fn){var cbs=pm.data("callbacks.postmessage");if(!cbs){cbs={};pm.data("callbacks.postmessage",cbs)}var r=pm._random();cbs[r]=fn;return r},_bind:function(){if(!pm.data("listening.postmessage")){if(window.addEventListener){window.addEventListener("message",pm._dispatch,false)}else{if(window.attachEvent){window.attachEvent("onmessage",pm._dispatch)}}pm.data("listening.postmessage",1)}},_dispatch:function(e){try{var msg=JSON.parse(e.data)}catch(ex){console.warn("postmessage data invalid json: ",ex);return}if(!msg.type){console.warn("postmessage message type required");return}var cbs=pm.data("callbacks.postmessage")||{},cb=cbs[msg.type];if(cb){cb(msg.data)}else{var l=pm.data("listeners.postmessage")||{},fns=l[msg.type]||[];for(var i=0,len=fns.length;i<len;i++){var o=fns[i];if(o.origin&&o.origin!=="*"&&e.origin!==o.origin){console.warn("postmessage message origin mismatch",e.origin,o.origin);if(msg.errback){var error={message:"postmessage origin mismatch",origin:[e.origin,o.origin]};pm.send({target:e.source,data:error,type:msg.errback})}continue}function sendReply(data){if(msg.callback){pm.send({target:e.source,data:data,type:msg.callback})}}try{if(o.callback){o.fn(msg.data,sendReply,e)}else{sendReply(o.fn(msg.data,e))}}catch(ex){if(msg.errback){pm.send({target:e.source,data:ex,type:msg.errback})}else{throw ex}}}}}};pm.hash={send:function(options,msg){var target_window=options.target,target_url=options.url;if(!target_url){console.warn("postmessage target window url is required");return}target_url=pm.hash._url(target_url);var source_window,source_url=pm.hash._url(window.location.href);if(window==target_window.parent){source_window="parent"}else{try{for(var i=0,len=parent.frames.length;i<len;i++){var f=parent.frames[i];if(f==window){source_window=i;break}}}catch(ex){source_window=window.name}}if(source_window==null){console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list");return}var hashmessage={"x-requested-with":"postmessage",source:{name:source_window,url:source_url},postmessage:msg},hash_id="#x-postmessage-id="+pm._random();target_window.location=target_url+hash_id+encodeURIComponent(JSON.stringify(hashmessage))},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:"#x-postmessage-id=".length+32,_bind:function(){if(!pm.data("polling.postmessage")){setInterval(function(){var hash=""+window.location.hash,m=pm.hash._regex.exec(hash);if(m){var id=m[1];if(pm.hash._last!==id){pm.hash._last=id;pm.hash._dispatch(hash.substring(pm.hash._regex_len))}}},$.pm.poll||200);pm.data("polling.postmessage",1)}},_dispatch:function(hash){if(!hash){return}try{hash=JSON.parse(decodeURIComponent(hash));if(!(hash["x-requested-with"]==="postmessage"&&hash.source&&hash.source.name!=null&&hash.source.url&&hash.postmessage)){return}}catch(ex){return}var msg=hash.postmessage,cbs=pm.data("callbacks.postmessage")||{},cb=cbs[msg.type];if(cb){cb(msg.data)}else{var source_window;if(hash.source.name==="parent"){source_window=window.parent}else{source_window=window.frames[hash.source.name]}var l=pm.data("listeners.postmessage")||{},fns=l[msg.type]||[];for(var i=0,len=fns.length;i<len;i++){var o=fns[i];if(o.origin){var origin=/https?\:\/\/[^\/]*/.exec(hash.source.url)[0];if(o.origin!=="*"&&origin!==o.origin){console.warn("postmessage message origin mismatch",origin,o.origin);if(msg.errback){var error={message:"postmessage origin mismatch",origin:[origin,o.origin]};pm.send({target:source_window,data:error,type:msg.errback,hash:true,url:hash.source.url})}continue}}function sendReply(data){if(msg.callback){pm.send({target:source_window,data:data,type:msg.callback,hash:true,url:hash.source.url})}}try{if(o.callback){o.fn(msg.data,sendReply)}else{sendReply(o.fn(msg.data))}}catch(ex){if(msg.errback){pm.send({target:source_window,data:ex,type:msg.errback,hash:true,url:hash.source.url})}else{throw ex}}}}},_url:function(url){return(""+url).replace(/#.*$/,"")}};$.extend(pm,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:false}})})(window,pmWrapper);return{JSON:JSON,pm:pmWrapper.pm,getQueryParam:function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec(window.location.href);if(results==null){return""}else{return decodeURIComponent(results[1])}},buildUrl:function(baseUrl,params){var url=baseUrl;if(typeof params!=="undefined"){if(baseUrl.indexOf("?")!=-1){url=url+"&"}else{url=url+"?"}var p=[];for(var i in params){p.push(i+"="+encodeURIComponent(params[i]))}url=url+p.join("&")}return url},setCookie:function(name,value,expires){var expiresString="";if(typeof expires!=="undefined"){if(typeof expires==="number"){var days=expires,t=expires=new Date();t.setDate(t.getDate()+days)}if(expires.toUTCString){var expiresString="; expires="+expires.toUTCString()}}document.cookie=encodeURIComponent(name)+"="+encodeURIComponent(value)+expiresString+"; path=/"},getCookie:function(name){function convert(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}return s}var cookies=document.cookie.split("; ");for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split("="),cookieName=decodeURIComponent(parts.shift()),cookie=decodeURIComponent(parts.join("="));if(name===cookieName){return convert(cookie)}}return null},removeCookie:function(name){var now=new Date();now.setDate(now.getDate()-1);document.cookie=encodeURIComponent(name)+"=; path=/; expires="+now.toUTCString()}}})();var platformUrl="https://cleeng.com";var myAccountUrl="https://myaccount.cleeng.com";var jsonpUrl="https://cleeng.com/api/3.0/jsonp";var tokenCookieName="CleengClientAccessToken";var token;var channelURL=platformUrl+"/js-api/3.0/default-channel.html";var iframeChannelURL=platformUrl+"/js-api/3.0/iframe-channel.html";PopupXDM.Config.iframeChannelURL=iframeChannelURL;var appId="35e97a6231236gb456heg6bd7a6bdsf7";var popupCallback;var additionalLoginParams="";var popupXdmClient;var authOptions={};function getUrlizedAuthOptions(){var p="";if(typeof authOptions.locale!=="undefined"){p+="&locale="+encodeURIComponent(authOptions.locale)}if(typeof authOptions.publisherId!=="undefined"){p+="&publisherId="+parseInt(authOptions.publisherId)}if(typeof authOptions.loginOnly!=="undefined"){p+="&loginOnly=1"}if(typeof authOptions.disableLogout!=="undefined"){p+="&disableLogout=1"}if(typeof authOptions.purchaseUri!=="undefined"){p+="&purchaseUri="+encodeURIComponent(authOptions.purchaseUri)}if(typeof authOptions.transactionExternalData!=="undefined"){p+="&transactionExternalData="+encodeURIComponent(authOptions.transactionExternalData)}if(typeof authOptions.branding!=="undefined"){p+="&branding="+encodeURIComponent(authOptions.branding)}if(typeof authOptions.customCssUrl!=="undefined"){p+="&customCssUrl="+encodeURIComponent(authOptions.customCssUrl)}if(typeof authOptions.order!=="undefined"){p+="&order="+encodeURIComponent(authOptions.order)}return p}function sendGtmEventOnAuthentication(result){if(typeof window.dataLayer==="undefined"){window.dataLayer=[]}if(result.registrationComplete){window.dataLayer.push({event:"registrationComplete",user:result.user})}}function sendGtmEventOnFinishPurchase(result){if(typeof window.dataLayer==="undefined"){window.dataLayer=[]}if(result.purchased){window.dataLayer.push({event:"purchaseComplete",user:result.user,discount:result.discount});const isFree=(typeof result.offerPrice!=="undefined"&&result.offerPrice===0);if(isFree===false&&result.discount&&result.discount.discountRate>0){window.dataLayer.push({event:"purchaseCompleteWithDiscount",user:result.user,discount:result.discount})}}}function processAuthResult(result){if(!result){result={}}if(typeof result.customerToken!=="undefined"){if(typeof result.customerTokenExpiresAt!=="undefined"){var expires=new Date();expires.setTime(result.customerTokenExpiresAt*1000)}else{var expires=14}PopupXDM.Util.setCookie(tokenCookieName,decodeURIComponent(result.customerToken),expires);token=result.customerToken}sendGtmEventOnAuthentication(result);sendGtmEventOnFinishPurchase(result);if(popupCallback){popupCallback(result)}if(typeof jQuery!=="undefined"){var event=jQuery.Event("cleengAuthWindowClose");event.result=result;jQuery(document).trigger(event)}}function initPopupXdmClient(){if(!popupXdmClient){popupXdmClient=new PopupXDM.Client();popupXdmClient.addEventListener("authWindowResult",function(event){processAuthResult(event.data)});PopupXDM.Config.popupWindowProperties.width=570;PopupXDM.Config.popupWindowProperties.height=610}}function showPopupWindow(url,callback){initPopupXdmClient();popupCallback=callback;popupXdmClient.setUrl(url);popupXdmClient.start()}function trackOffer(offerId,action){initPopupXdmClient();if(!popupXdmClient.isFrameHelperLoaded()){setTimeout(function(){trackOffer(offerId,action)},350);return}PopupXDM.Util.pm({type:action,target:popupXdmClient.getChannelFrameHandle().contentWindow,url:iframeChannelURL,data:{offerId:offerId}})}window.__cleeng_third_party_cookie_proxy=function(inlineOrOverlayOpen,popupOpen){if(window.__cleeng_third_party_cookie_element_clicked==undefined||!window.__cleeng_third_party_cookie_element_clicked){inlineOrOverlayOpen();return}var httpSetCookieRequest=new XMLHttpRequest();httpSetCookieRequest.open("GET",platformUrl+"/js-api/3.0/set-third-party.js.php",false);httpSetCookieRequest.withCredentials=true;httpSetCookieRequest.onreadystatechange=function(){if(httpSetCookieRequest.readyState===XMLHttpRequest.DONE&&httpSetCookieRequest.status===200){var httpGetCookieRequest=new XMLHttpRequest();httpGetCookieRequest.open("GET",platformUrl+"/js-api/3.0/get-third-party.js.php",false);httpGetCookieRequest.withCredentials=true;httpGetCookieRequest.onreadystatechange=function(){if(httpGetCookieRequest.readyState===XMLHttpRequest.DONE&&httpGetCookieRequest.status===200){if(httpGetCookieRequest.response=="true"){inlineOrOverlayOpen()}else{popupOpen()}}};httpGetCookieRequest.send()}};httpSetCookieRequest.send()};function CleengApi(){}CleengApi.prototype.init=function(data){if(data){if(typeof data.channelURL!=="undefined"){this.setChannelURL(data.channelURL)}if(typeof data.appId!=="undefined"){this.setAppId(data.appId)}if(typeof data.token!=="undefined"){this.setToken(data.token)}if(typeof data.tokenCookieName!=="undefined"){this.setTokenCookieName(data.tokenCookieName)}}if(!token&&PopupXDM.Util.getCookie(tokenCookieName)){this.setToken(PopupXDM.Util.getCookie(tokenCookieName))}if(typeof(_onCleengApiLoad)==="function"){_onCleengApiLoad()}};CleengApi.prototype.setTokenCookieName=function(name){tokenCookieName=name;return this};CleengApi.prototype.getTokenCookieName=function(){return tokenCookieName};CleengApi.prototype.setAppId=function(newAppId){appId=newAppId;return this};CleengApi.prototype.getAppId=function(){return appId};CleengApi.prototype.setToken=function(newToken){token=newToken;return this};CleengApi.prototype.getToken=function(){return token};CleengApi.prototype.setPopupCallback=function(callback){popupCallback=callback;return this};CleengApi.prototype.getPopupCallback=function(){return popupCallback};CleengApi.prototype.setChannelURL=function(newChannelURL){channelURL=newChannelURL;channelMode="url";return this};CleengApi.prototype.getChannelURL=function(){return channelURL};CleengApi.prototype.getPopupXdmClient=function(){return popupXdmClient};CleengApi.prototype.setAdditionalLoginParams=function(params){additionalLoginParams="&"+params};CleengApi.prototype.setIframeChannelURL=function(url){iframeChannelURL=url};CleengApi.prototype.closeAllOverlays=function(){var closeButtons=document.querySelectorAll(".cleeng-myaccount-close, .cleeng-contact-form-close, .cleeng-checkout-close");var result=false;var closeButton,key;for(key in closeButtons){closeButton=closeButtons[key];if(closeButton&&closeButton.onclick){closeButton.onclick();closeButton.onclick=false;result=result||true}}return result};function jsonpRequest(url){var script=document.createElement("script");script.type="text/javascript";script.src=url;var head=document.getElementsByTagName("head")[0];head.insertBefore(script,head.firstChild)}function api(method,params,callback){if(typeof params!=="String"){params=JSON.stringify(params)}var callbackName="__cleeng_cb_"+Math.round(Math.random()*1000000);window[callbackName]=function(result){if(callback){callback(result)}};var url=jsonpUrl+"?callback="+callbackName+"&method="+method+"&r="+Math.random();url+="&params="+params;jsonpRequest(url)}CleengApi.prototype.api=function(method,params,callback){api(method,params,callback)};CleengApi.prototype.trackOfferImpression=function(offerId,callback){initPopupXdmClient();popupXdmClient.initFrameHelper();trackOffer(offerId,"ga_track_impression");if(!token){var tokenParam=""}else{var tokenParam=token}};CleengApi.prototype.getCustomer=function(callback){if(!token){var tokenParam=""}else{var tokenParam=token}api("getCustomer",{customerToken:encodeURIComponent(tokenParam)},callback)};CleengApi.prototype.getAccessStatus=function(offerId,callback){if(!token){var tokenParam=""}else{var tokenParam=token}api("getAccessStatus",{customerToken:encodeURIComponent(tokenParam),offerId:offerId},callback)};CleengApi.prototype.addEventListener=function(event,callback){popupXdmClient.addEventListener(event,callback)};CleengApi.prototype.setAuthOption=function(name,value){switch(name){case"locale":case"windowWidth":case"windowHeight":case"publisherId":case"purchaseUri":case"transactionExternalData":case"loginOnly":case"disableLogout":case"branding":case"customCssUrl":case"order":authOptions[name]=value;break}};CleengApi.prototype.login=function(callback){showPopupWindow(platformUrl+"/auth/2/login/?v=3.0&appId="+appId+"&popup=1&redirectUri="+encodeURIComponent(channelURL)+getUrlizedAuthOptions()+getGATrackingCode()+additionalLoginParams,callback)};CleengApi.prototype.register=function(callback){showPopupWindow(platformUrl+"/auth/2/register/?v=3.0&appId="+appId+"&popup=1&redirectUri="+encodeURIComponent(channelURL)+getUrlizedAuthOptions()+getGATrackingCode()+additionalLoginParams,callback)};CleengApi.prototype.purchase=function(offerId,callback){if(typeof offerId!=="string"&&offerId.join){offerId=offerId.join(",")}trackOffer(offerId,"ga_track_click");showPopupWindow(platformUrl+"/auth/2/purchase/?v=3.0&appId="+appId+"&offerId="+offerId+"&popup=1&redirectUri="+encodeURIComponent(channelURL)+getUrlizedAuthOptions()+getGATrackingCode()+additionalLoginParams,callback)};CleengApi.prototype.popupMyAccount=function(publisherId,callback){showPopupWindow(myAccountUrl+"/us/"+publisherId+"?"+getUrlizedAuthOptions()+getGATrackingCode(),callback)};CleengApi.prototype.popupContactForm=function(options,callback){var url=platformUrl+"/webapi/contact-form?publisherId="+options.publisherId;if(options.offerId){url=url+"&offerId="+options.offerId}if(options.locale){url=url+"&locale="+options.locale}if(options.contactFormFaq){url=url+"&faq="+options.contactFormFaq}showPopupWindow(url,callback)};CleengApi.prototype.updatePaymentDetails=function(publisherId,callback){showPopupWindow(platformUrl+"/auth/2/update-payment-details/?v=3.0&appId="+appId+"&publisherId="+publisherId+"&popup=1&redirectUri="+encodeURIComponent(channelURL)+getUrlizedAuthOptions()+getGATrackingCode()+additionalLoginParams,callback)};CleengApi.prototype.publisherLogin=function(appSecureKey,callback){showPopupWindow(platformUrl+"/auth/2/publisher-login/?v=3.0&appId="+appId+"&appSecureKey="+appSecureKey+"&popup=1&widget=1&redirectUri="+encodeURIComponent(channelURL)+getGATrackingCode()+additionalLoginParams,callback)};CleengApi.prototype.publisherRegistration=function(appSecureKey,callback){showPopupWindow(platformUrl+"/auth/2/publisher-registration/?v=3.0&appId="+appId+"&appSecureKey="+appSecureKey+"&popup=1&widget=1&redirectUri="+encodeURIComponent(channelURL)+getGATrackingCode()+additionalLoginParams,callback)};CleengApi.prototype.autologin=function(callback){window.__cleeng_autologin_callback=function(data){if(typeof data.key!=="undefined"){api("autologin",{applicationId:appId,key:data.key},function(result){if(typeof result.customerToken!=="undefined"&&result.customerToken){token=result.customerToken;PopupXDM.Util.setCookie(tokenCookieName,token);if(typeof callback!=="undefined"){callback(result)}}})}else{if(typeof callback!=="undefined"){callback({success:false})}}};var script=document.createElement("script");script.type="text/javascript";script.src=platformUrl+"/autologin/autologin.js?callback=__cleeng_autologin_callback&r="+Math.random();var head=document.getElementsByTagName("head")[0];head.insertBefore(script,head.firstChild)};CleengApi.prototype.showCustomAuthWindow=function(url,callback){showPopupWindow(url,callback)};CleengApi.prototype.logout=function(callback){var callbackName="__cleeng_cb_"+Math.round(Math.random()*1000000);window[callbackName]=function(result){if(callback){callback(result)}};jsonpRequest(platformUrl+"/logout?token="+token+"&format=jsonp&callback="+callbackName);PopupXDM.Util.removeCookie(tokenCookieName);token=null};CleengApi.prototype.stopSubscription=function(offerId,callback){if(typeof offerId!=="string"&&offerId.join){offerId=offerId.join(",")}showPopupWindow(platformUrl+"/auth/2/stop-subscription/?v=3.0&appId="+appId+"&offerId="+offerId+"&popup=1&redirectUri="+encodeURIComponent(channelURL)+getUrlizedAuthOptions()+getGATrackingCode()+additionalLoginParams,callback)};CleengApi.prototype.getLoginUrl=function(redirectUri){return platformUrl+"/auth/2/login/?v=3.0&appId="+appId+"&popup=1&redirectUri="+encodeURIComponent(redirectUri)+getUrlizedAuthOptions()+getGATrackingCode()+additionalLoginParams};CleengApi.prototype.getLogoutUrl=function(redirectUri){return platformUrl+"/auth/2/logout/?v=3.0&appId="+appId+"&popup=1&redirectUri="+encodeURIComponent(redirectUri)+getUrlizedAuthOptions()+getGATrackingCode()+additionalLoginParams};CleengApi.prototype.getRegisterUrl=function(redirectUri){return platformUrl+"/auth/2/register/?v=3.0&appId="+appId+"&popup=1&redirectUri="+encodeURIComponent(redirectUri)+getUrlizedAuthOptions()+getGATrackingCode()+additionalLoginParams};CleengApi.prototype.getPurchaseUrl=function(offerId,redirectUri,transactionExternalData){if(typeof transactionExternalData!=="undefined"){CleengApi.prototype.setAuthOption("transactionExternalData",transactionExternalData)}return platformUrl+"/auth/2/purchase/?v=3.0&appId="+appId+"&offerId="+offerId+"&popup=1&redirectUri="+encodeURIComponent(redirectUri)+getUrlizedAuthOptions()+getGATrackingCode()+additionalLoginParams};var checkoutChannelUrl=platformUrl+"/js-api/3.0/checkout-channel.html";var iframes=[];function getLinkerParam(uaNumber){if(!window.GoogleAnalyticsObject){return}var _ga=window[window.GoogleAnalyticsObject];if(!_ga.getAll){return}var trackers=_ga.getAll();var i;for(i=0;i<trackers.length;i++){var _tracker=trackers[i];if(!uaNumber||_tracker.get("trackingId")===uaNumber){return _tracker.get("linkerParam")}}}function getClientId(uaNumber){if(!window.GoogleAnalyticsObject){return}var _ga=window[window.GoogleAnalyticsObject];if(!_ga.getAll){return}var trackers=_ga.getAll();var i;for(i=0;i<trackers.length;i++){var _tracker=trackers[i];if(!uaNumber||_tracker.get("trackingId")===uaNumber){return _tracker.get("clientId")}}}function createIframeElement(options){var iframe=document.createElement("iframe");var gaTackingId=getLinkerParam();if(gaTackingId){options.gaTackingId=gaTackingId}if(options.displayType=="inline"||options.displayType=="overlay"){safariSessionWorkaround(iframe)}iframe.src=buildUrl(options);iframe.frameBorder=0;iframe.webkitAllowFullScreen="";iframe.allowFullScreen="";return iframe}function finishPurchase(options){PopupXDM.Util.pm.unbind("checkoutFinish");PopupXDM.Util.pm.bind("checkoutFinish",function(result){if(typeof result.customerToken!=="undefined"){var expires=14;if(typeof result.customerTokenExpiresAt!=="undefined"){expires=new Date();expires.setTime(result.customerTokenExpiresAt*1000)}PopupXDM.Util.setCookie(tokenCookieName,decodeURIComponent(result.customerToken),expires);token=result.customerToken}sendGtmEventOnAuthentication(result);sendGtmEventOnFinishPurchase(result);if(result.authorizationSuccessful&&options.action==="authentication"){console.warn("You are already logged in, please use API method to check");hideContainersLoaders(options)}else{if(result.accessGranted&&options.action==="checkout"){console.warn("You already gained access to this offer, please use API method to check");hideContainersLoaders(options)}}options.completed(result)})}function hideContainersLoaders(options){var overlay=document.getElementById("cleeng-checkout-overlay");if(overlay){overlay.style.display="none"}var containers=document.getElementsByClassName("cleeng-checkout-main-container-overlay");var cCount=containers.length;for(var i=0;i<cCount;i++){containers[i].style.display="none"}if("containerId" in options){document.getElementById(options.containerId).style.display="none"}}var iframesCounter=0;function processOverlay(options,iframe){if(iframesCounter==0){var head=document.head,link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=platformUrl+"/checkout-flow/css/checkout-overlay.css?v1";head.appendChild(link)}var overlay=document.getElementById("cleeng-checkout-overlay")?document.getElementById("cleeng-checkout-overlay"):document.createElement("div");overlay.id="cleeng-checkout-overlay";overlay.className="cleeng-checkout-overlay";overlay.onclick=function(){hideOverlay(mainContainer,overlay);options.completed({})};if(!document.getElementById("cleeng-checkout-overlay")){document.body.appendChild(overlay)}else{overlay.style.display="block"}var close=document.createElement("div");var container=document.createElement("div");var mainContainer=document.createElement("div");iframe.className="cleeng-checkout-iframe-overlay";iframe.id="cleeng-checkout-iframe-"+iframesCounter;container.className="cleeng-checkout-container-overlay";mainContainer.id="cleeng-checkout-main-container"+iframesCounter;mainContainer.className="cleeng-checkout-main-container-overlay";var loader=document.createElement("div");loader.className="loader";close.onclick=function(){hideOverlay(mainContainer,overlay);options.completed({})};close.setAttribute("class","cleeng-checkout-close");document.body.appendChild(mainContainer);container.appendChild(iframe);mainContainer.appendChild(loader);mainContainer.appendChild(container);mainContainer.appendChild(close);iframesCounter++}function showOverlay(mainContainer,overlay){mainContainer.style.display="block";overlay.style.display="block"}function hideOverlay(mainContainer,overlay){var obj=mainContainer.querySelector(".cleeng-checkout-iframe-overlay");if(mainContainer.querySelector(".cleeng-checkout-iframe-overlay")!=undefined){mainContainer.parentElement.removeChild(mainContainer)}overlay.style.display="none"}var inlineLinkAdded=false;function processInline(options,iframe){if(!inlineLinkAdded){var head=document.head,link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=platformUrl+"/checkout-flow/css/checkout-inline.css";head.appendChild(link)}inlineLinkAdded=true;var container=document.createElement("div");iframe.className=iframe.className+" cleeng-checkout-iframe";container.className="cleeng-checkout-main-container loading";var checkoutMainContainer=document.getElementById(options.containerId);checkoutMainContainer.style.maxWidth=options.width+"px";checkoutMainContainer.style.maxHeight=options.height+"px";container.innerHTML='<i class="cleeng-checkout-loader refresh-animate fa fa-refresh"></i>';checkoutMainContainer.innerHTML="";checkoutMainContainer.appendChild(container);setTimeout(function(){container.appendChild(iframe)},150)}function showInline(options){var container=document.getElementById(options.containerId);container.style.display="block"}function hideInline(options){var container=document.getElementById(options.containerId);container.style.display="none"}function createMyAccountIframeElement(options){var iframe=document.createElement("iframe");iframe.src=buildMyAccountUrl(options);iframe.frameBorder=0;iframe.webkitAllowFullScreen="";iframe.allowFullScreen="";return iframe}var myAccountIframesCounter=0;function processMyAccountOverlay(options,iframe){if(myAccountIframesCounter==0){var head=document.head,link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=platformUrl+"/checkout-flow/css/myaccount-overlay.css";head.appendChild(link)}var overlay=document.getElementById("cleeng-myaccount-overlay")?document.getElementById("cleeng-myaccount-overlay"):document.createElement("div");overlay.id="cleeng-myaccount-overlay";overlay.className="cleeng-myaccount-overlay";overlay.onclick=function(){hideMyAccountOverlay(mainContainer,overlay);options.completed({})};if(!document.getElementById("cleeng-myaccount-overlay")){document.body.appendChild(overlay)}else{overlay.style.display="block"}var close=document.createElement("div");var container=document.createElement("div");var mainContainer=document.createElement("div");iframe.className="cleeng-myaccount-iframe-overlay";iframe.id="cleeng-myaccount-iframe-"+myAccountIframesCounter;iframe.scrolling="no";container.className="cleeng-myaccount-container-overlay";mainContainer.id="cleeng-myaccount-main-container"+myAccountIframesCounter;mainContainer.className="cleeng-myaccount-main-container-overlay";var loader=document.createElement("div");loader.className="loader";close.onclick=function(){hideMyAccountOverlay(mainContainer,overlay);options.completed({})};close.setAttribute("class","cleeng-myaccount-close");document.body.appendChild(mainContainer);container.appendChild(iframe);mainContainer.appendChild(loader);mainContainer.appendChild(container);mainContainer.appendChild(close);myAccountIframesCounter++}function showMyAccountOverlay(mainContainer,overlay){mainContainer.style.display="block";overlay.style.display="block"}function hideMyAccountOverlay(mainContainer,overlay){var obj=mainContainer.querySelector(".cleeng-myaccount-iframe-overlay");if(mainContainer.querySelector(".cleeng-myaccount-iframe-overlay")!=undefined){mainContainer.parentElement.removeChild(mainContainer)}overlay.style.display="none"}var inlineMyAccountLinkAdded=false;function processMyAccountInline(options,iframe){if(!inlineMyAccountLinkAdded){var head=document.head,link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=platformUrl+"/checkout-flow/css/myaccount-inline.css";head.appendChild(link)}inlineMyAccountLinkAdded=true;var container=document.createElement("div");iframe.className=iframe.className+" cleeng-myaccount-iframe";iframe.scrolling="no";container.className="cleeng-myaccount-main-container loading";var myAccountMainContainer=document.getElementById(options.containerId);myAccountMainContainer.style.maxWidth=options.width+"px";myAccountMainContainer.style.maxHeight=options.height+"px";container.innerHTML='<i class="cleeng-myaccount-loader refresh-animate fa fa-refresh"></i>';myAccountMainContainer.innerHTML="";myAccountMainContainer.appendChild(container);setTimeout(function(){container.appendChild(iframe)},150)}function showMyAccountInline(options){var container=document.getElementById(options.containerId);container.style.display="block"}function hideMyAccountInline(options){var container=document.getElementById(options.containerId);container.style.display="none"}CleengApi.prototype.myAccount=function(options){if(validateMyAccount(options)){options.action="my-account";myAccount(options)}};function myAccount(options){setAuthOptions(options);if(!("displayType" in options)||!options.displayType){options.displayType="overlay"}if(options.displayType==="popup"){processPopup(options);return}var iframe=createMyAccountIframeElement(options);if(options.displayType==="inline"){if(options.containerId){window.__cleeng_third_party_cookie_proxy(function(){processMyAccountInline(options,iframe)},function(){processPopup(options)})}else{throw new Error("No containerId set")}}else{window.__cleeng_third_party_cookie_proxy(function(){processMyAccountOverlay(options,iframe)},function(){processPopup(options)})}}function validateMyAccount(options){var valid=true;if(!("publisherId" in options)&&!("customUrl" in options)){valid=false;throw new Error("PublisherId is missing or empty.")}return valid}function buildMyAccountUrl(options){if(options.action&&options.action==="my-account"){if(options&&options.customUrl){return options.customUrl+"&"+getUrlizedAuthOptions()+getGATrackingCode()}return myAccountUrl+"/us/"+options.publisherId+"?"+getUrlizedAuthOptions()+getGATrackingCode()}}function processPopup(options){if(options.action&&(options.action==="authentication"||options.action==="login-only")){CleengApi.prototype.login(function(result){options.completed(result)})}else{if(options.action=="checkout"){if(options.publisherId){CleengApi.prototype.setAdditionalLoginParams("publisherId="+options.publisherId)}CleengApi.prototype.purchase(options.offerId,function(result){options.completed(result)})}else{if(options.action=="my-account"){CleengApi.prototype.popupMyAccount(options.publisherId,function(result){options.completed(result)})}else{if(options.action=="contact-form"){CleengApi.prototype.popupContactForm(options,function(result){options.completed(result)})}else{CleengApi.prototype.showCustomAuthWindow(options.customUrl,function(result){options.completed(result)})}}}}}window.CleengApi=new CleengApi();window.CleengApi.init();window.PopupXDM=PopupXDM;document.addEventListener("DOMContentLoaded",function(){parseCleengElements()},false);CleengApi.prototype.contactForm=function(options){if(validateContactForm(options)){options.action="contact-form";contactForm(options)}else{return}};function validateContactForm(options){var valid=true;if(!("publisherId" in options)){valid=false;throw new Error("PublisherId is missing or empty.")}return valid}function contactForm(options){if(!("displayType" in options)||!options.displayType){options.displayType="inline"}if(options.displayType==="popup"){processPopup(options);return}var iframe=createIframeContactFormElement(options);if(options.displayType==="inline"){if(options.containerId){window.__cleeng_third_party_cookie_proxy(function(){processContactFormInline(options,iframe)},function(){processPopup(options)})}else{throw new Error("No containerId set")}}else{window.__cleeng_third_party_cookie_proxy(function(){processContactFormOverlay(options,iframe)},function(){processPopup(options)})}}function createIframeContactFormElement(options){var iframe=document.createElement("iframe");safariSessionWorkaround(iframe);iframe.src=buildContactFormUrl(options);iframe.frameBorder=0;iframe.webkitAllowFullScreen="";iframe.allowFullScreen="";return iframe}function buildContactFormUrl(options){var url=platformUrl+"/webapi/contact-form?publisherId="+options.publisherId;if(options.offerId){url=url+"&offerId="+options.offerId}if(options.locale){url=url+"&locale="+options.locale}if(options.contactFormFaq){url=url+"&faq="+options.contactFormFaq}return url}function processContactFormInline(options,iframe){var container=document.createElement("div");var head=document.head,link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=platformUrl+"/contact-form/css/contact-form-inline.css";head.appendChild(link);iframe.className=iframe.className+" cleeng-contact-form-iframe";container.className="contact-from-main-container loading";var checkoutMainContainer=document.getElementById(options.containerId);checkoutMainContainer.style.maxWidth=options.width+"px";checkoutMainContainer.style.maxHeight=options.height+"px";container.innerHTML='<i class="cleeng-contact-form-loader refresh-animate fa fa-refresh"></i>';checkoutMainContainer.innerHTML="";checkoutMainContainer.appendChild(container);setTimeout(function(){container.appendChild(iframe)},150)}var contactFormIframesCounter=0;function processContactFormOverlay(options,iframe){if(contactFormIframesCounter==0){var head=document.head,link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=platformUrl+"/contact-form/css/contact-form-overlay.css";head.appendChild(link)}var overlay=document.getElementById("cleeng-contact-form-overlay")?document.getElementById("cleeng-contact-form-overlay"):document.createElement("div");overlay.id="cleeng-contact-form-overlay";overlay.className="cleeng-contact-form-overlay";overlay.onclick=function(){hideContactFormOverlay(mainContainer,overlay);options.completed({})};if(!document.getElementById("cleeng-contact-form-overlay")){document.body.appendChild(overlay)}else{overlay.style.display="block"}var close=document.createElement("div");var container=document.createElement("div");var mainContainer=document.createElement("div");iframe.className="cleeng-contact-form-iframe-overlay";iframe.id="cleeng-contact-form-iframe-"+contactFormIframesCounter;container.className="cleeng-contact-form-container-overlay";mainContainer.id="cleeng-contact-form-main-container"+contactFormIframesCounter;mainContainer.className="cleeng-contact-form-main-container-overlay";if(options&&options.contactFormFaq==="false"){mainContainer.className+=" cleeng-contact-form-main-container-no-faq"}var loader=document.createElement("div");loader.className="loader";close.onclick=function(){hideContactFormOverlay(mainContainer,overlay);options.completed({})};close.setAttribute("class","cleeng-contact-form-close");close.innerHTML="×";document.body.appendChild(mainContainer);container.appendChild(iframe);mainContainer.appendChild(loader);mainContainer.appendChild(container);mainContainer.appendChild(close);contactFormIframesCounter++}function showContactFormOverlay(mainContainer,overlay){mainContainer.style.display="block";overlay.style.display="block"}function hideContactFormOverlay(mainContainer,overlay){var obj=mainContainer.querySelector(".cleeng-contact-form-iframe-overlay");if(mainContainer.querySelector(".cleeng-contact-form-iframe-overlay")!=undefined){mainContainer.parentElement.removeChild(mainContainer)}overlay.style.display="none"}CleengApi.prototype.checkout=function(options){if(validateCheckout(options)){options.action="checkout";checkout(options)}else{return}};CleengApi.prototype.authentication=function(options){if(validateAuthentication(options)){options.action="authentication";CleengApi.prototype.setAuthOption("publisherId",options.publisherId);checkout(options)}else{return}};CleengApi.prototype.loginOnly=function(options){if(validateAuthentication(options)){options.action="authentication";options.loginOnly=true;CleengApi.prototype.setAuthOption("publisherId",options.publisherId);checkout(options)}else{return}};CleengApi.prototype.customCheckout=function(options){if(validateCustomCheckout(options)){options.action="custom";if(options.displayType!="popup"){options.customUrl+="&redirectUri="+encodeURIComponent(checkoutChannelUrl)}checkout(options)}else{return}};function checkout(options){setAuthOptions(options);if(!("displayType" in options)||!options.displayType){options.displayType="overlay"}if(options.displayType==="popup"){processPopup(options);return}var iframe=createIframeElement(options);if(options.displayType==="inline"){if(options.containerId){window.__cleeng_third_party_cookie_proxy(function(){processInline(options,iframe)},function(){processPopup(options)})}else{throw new Error("No containerId set")}}else{window.__cleeng_third_party_cookie_element_clicked=true;window.__cleeng_third_party_cookie_proxy(function(){processOverlay(options,iframe)},function(){processPopup(options)})}finishPurchase(options)}function validateCheckout(options){var valid=true;if(!("offerId" in options)||!options.offerId){valid=false;throw new Error("OfferId is missing or empty.")}if(("offerId" in options)&&("publisherId" in options)){console.warn("You're usinng 'checkout' function, publisherId is obsolete and will be ignored.")}return valid}function validateAuthentication(options){var valid=true;if(!("publisherId" in options)||!options.publisherId){valid=false;throw new Error("PublisherId is missing or empty.")}if(("offerId" in options)&&("publisherId" in options)){console.warn("You're usinng 'authentication' function, offerId is obsolete and will be ignored.")}return valid}function validateCustomCheckout(options){var valid=true;if(!("customUrl" in options)||!options.customUrl){valid=false;throw new Error("CustomUrl option is missign")}if(("offerId" in options)||("publisherId" in options)){console.warn("You're usinng 'custom' function, offerId and publisheId is obsolete and will be ignored.")}return valid}function safariSessionWorkaround(iframe){var isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);if(!isSafari){return}if(PopupXDM.Util.getCookie("cleengVisit")){return}PopupXDM.Util.setCookie("cleengVisit","true",14);var sfPopup=window.open(platformUrl+"/js-api/3.0/cookie-authorization.html","Cookie authorization","width=1,height=1");if(sfPopup==undefined){return}PopupXDM.Util.pm.bind("cookieAuthorized",function(){sfPopup.close();if(iframe.src!=undefined&&iframe.src!=null){var src=iframe.src;iframe.src=src+"#safariFix"}})}function safariSessionWorkaround2(callback,iframe){var isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);if(!isSafari){if(typeof callback==="function"){callback()}return}if(PopupXDM.Util.getCookie("cleengVisit")){if(typeof callback==="function"){callback()}return}PopupXDM.Util.setCookie("cleengVisit","true",14);var sfPopup=window.open(platformUrl+"/js-api/3.0/cookie-authorization.html","Cookie authorization","width=1,height=1");if(sfPopup==undefined){if(typeof callback==="function"){callback()}return}PopupXDM.Util.pm.bind("cookieAuthorized",function(){sfPopup.close();if(typeof callback==="function"){callback()}})}CleengApi.prototype.prepareCleengForInline=safariSessionWorkaround2;function buildUrl(options){if(options.action&&options.action==="authentication"){var loginOnly=("loginOnly" in options&&options.loginOnly)?"&loginOnly=true":"";return platformUrl+"/auth/2/login/?v=3.0&appId="+appId+"&checkoutType="+options.displayType+"&redirectUri="+encodeURIComponent(checkoutChannelUrl)+getUrlAuthOptions(options)+loginOnly}if(options.customUrl){var p;if(options.customCssUrl){p+="&customCssUrl="+encodeURIComponent(options.customCssUrl)}else{if(typeof authOptions.customCssUrl!=="undefined"){p+="&customCssUrl="+encodeURIComponent(authOptions.customCssUrl)}}return options.customUrl+"&checkoutType="+options.displayType+"&branding="+options.branding+getParamsForGATrackingCode(options)+p}var offers="";if(options.offerId){var offerIds=options.offerId.split(",");offers+="&offerId=";for(var i=0;i<offerIds.length;i++){var offer=offerIds[i].trim();if(offerIds.length-1==i){offers+=offer}else{offers+=offer+","}}}return platformUrl+"/auth/2/purchase/?v=3.0&appId="+appId+offers+"&checkoutType="+options.displayType+"&redirectUri="+encodeURIComponent(checkoutChannelUrl)+getParamsForGATrackingCode(options)+getUrlizedAuthOptions(options)}function setAuthOptions(options){if(options.locale){CleengApi.prototype.setAuthOption("locale",options.locale)}if(options.transactionExternalData){CleengApi.prototype.setAuthOption("transactionExternalData",options.transactionExternalData)}if("loginOnly" in options&&options.loginOnly){CleengApi.prototype.setAuthOption("loginOnly",true)}else{CleengApi.prototype.setAuthOption("loginOnly",undefined)}if(options.disableLogout){CleengApi.prototype.setAuthOption("disableLogout",true)}if(options.publisherId){CleengApi.prototype.setAuthOption("publisherId",options.publisherId)}if(options.customCssUrl){CleengApi.prototype.setAuthOption("customCssUrl",options.customCssUrl)}if(options.order){CleengApi.prototype.setAuthOption("order",options.order)}}function getUrlAuthOptions(options){var p="";if(options.locale){p+="&locale="+encodeURIComponent(options.locale)}if(options.publisherId){p+="&publisherId="+parseInt(options.publisherId)}if(options.transactionExternalData){p+="&transactionExternalData="+encodeURIComponent(options.transactionExternalData)}if(options.action==="login-only"){p+="&loginOnly=1"}if(options.disableLogout){p+="&disableLogout=1"}if(options.branding!=="undefined"){p+="&branding="+encodeURIComponent(options.branding)}if(options.customCssUrl){p+="&customCssUrl="+encodeURIComponent(options.customCssUrl)}if(options.gaTackingId){p+=getParamsForGATrackingCode(options)}return p}function getParamsForGATrackingCode(options){return options.gaTackingId?"&"+options.gaTackingId:""}function getGATrackingCode(options){var gaTackingId=getLinkerParam();return gaTackingId?"&"+gaTackingId:""}function parseCleengElements(){var triggers=document.querySelectorAll("[data-cleeng-trigger]"),i;var tCount=triggers.length;for(i=0;i<tCount;++i){initTriggerElement(triggers[i])}var containers=document.querySelectorAll("[data-cleeng-container]"),j;var cCount=containers.length;for(j=0;j<cCount;++j){initContainerElement(containers[j],j)}}function initTriggerElement(element){var mapped=mapElements(element.attributes);if(mapped.action=="checkout"){element.onclick=function(){window.__cleeng_third_party_cookie_element_clicked=true;CleengApi.prototype.checkout(mapped)}}else{if(mapped.action=="authentication"){element.onclick=function(){window.__cleeng_third_party_cookie_element_clicked=true;CleengApi.prototype.authentication(mapped)}}else{if(mapped.action=="my-account"){element.onclick=function(){window.__cleeng_third_party_cookie_element_clicked=true;CleengApi.prototype.myAccount(mapped)}}else{if(mapped.action=="login-only"){element.onclick=function(){CleengApi.prototype.loginOnly(mapped)}}else{if(mapped.action=="contact-form"){element.onclick=function(){CleengApi.prototype.contactForm(mapped)}}}}}}}function initContainerElement(element,no){var mapped=mapElements(element.attributes);if(!element.id){element.id="cleeng-container-"+no}mapped.containerId=element.id;element.innerHTML="";if(mapped.displayType!="inline"){console.warn("You're usinng 'data-cleeng-container' attribute which should be used with data-display-type 'inline' ")}if(mapped.action==="checkout"){CleengApi.prototype.checkout(mapped)}else{if(mapped.action==="authentication"){CleengApi.prototype.authentication(mapped)}else{if(mapped.action==="contact-form"){CleengApi.prototype.contactForm(mapped)}}}}function mapElements(attributes){var options={};if("data-action" in attributes){options.action=attributes["data-action"].nodeValue}if("data-display-type" in attributes){options.displayType=attributes["data-display-type"].nodeValue}if("data-container-id" in attributes){options.containerId=attributes["data-container-id"].nodeValue}if("data-offer-id" in attributes){options.offerId=attributes["data-offer-id"].nodeValue}if("data-publisher-id" in attributes){options.publisherId=attributes["data-publisher-id"].nodeValue}if("data-transaction-external-data" in attributes){options.transactionExternalData=attributes["data-transaction-external-data"].nodeValue}if("data-locale" in attributes){options.locale=attributes["data-locale"].nodeValue}if("data-completed-callback" in attributes){var func=new Function("result",attributes["data-completed-callback"].nodeValue);options.completed=func}if("data-custom-css-url" in attributes){options.customCssUrl=attributes["data-custom-css-url"].nodeValue}if("data-disable-logout" in attributes){options.disableLogout=attributes["data-disable-logout"].nodeValue}if("data-contact-form-faq" in attributes){options.contactFormFaq=attributes["data-contact-form-faq"].nodeValue}if("data-order" in attributes){options.order=attributes["data-order"].nodeValue}return options}})();